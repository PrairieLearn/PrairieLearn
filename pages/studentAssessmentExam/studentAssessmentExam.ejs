<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/head'); %>
  </head>
  <body>
    <%- include('../partials/navbar', {navPage: ''}); %>
    <div id="content" class="container">
      <div class="card mb-4">
        
        <div class="card-header bg-primary text-white">
          <%= assessment_set.abbreviation %><%= assessment.number %>: <%= assessment.title %>
        </div>

        <div class="card-body">

          <% if (authz_result.mode == 'Exam' || authz_result.mode == 'SEB' || authz_result.password != null ) { %>
            <p class="lead text-center">
              Please wait until instructed to start by a proctor
            </p>
          <% } %>
          
          <p class="lead text-center">
            This is <strong><%= assessment_set.name %> <%= assessment.number %>: <%= assessment.title %></strong> for <strong><%= course.short_name %></strong>
          </p>
          <% if (authz_result.time_limit_min != undefined) { %>
          <p class="lead text-center">
            The time limit for this assessment is
            <strong>
              <%= authz_result.time_limit_min %>
              <%= (authz_result.time_limit_min == 1) ? 'minute' : 'minutes' %>
            </strong>
          </p>
          <% } %>
          <form id="confirm-form" name="confirm-form" method="POST">
            <input type="hidden" name="__action" value="newInstance">
            <input type="hidden" name="__csrf_token" value="<%= __csrf_token %>">
            <div class="d-flex justify-content-center">
              <button id="start-assessment" type="submit" class="btn btn-primary">
                <% if (assessment.multiple_instance) { %>
                  New instance 
                <% } else { %>
                  Start Assessment
                <% } %>
              </button>
            </div>
          </form>
          <script>
            $('#confirm-form').on('submit', function() {
                $('#start-assessment')
                    .prop('disabled', true)
                    .html('<i class="fa fa-sync fa-spin fa-fw"></i> Generating questionsâ€¦');
            });
          </script>

        </div> <!-- panel-body -->

        <% if (assessment.multiple_instance) { %>
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th style="width: 1%">Instances</th>
                <th></th>
                <th class="text-center">Available credit</th>
                <th class="text-center">Score</th>
              </tr>
            </thead>
            <tbody>
              <% rows.forEach(function(row) { %>
              <% if (row.start_new_set) { %>
              <tr>
                <th colspan="4"><%= row.assessment_set_heading %></th>
              </tr>
              <% } %>
              <tr>
                <td class="align-middle" style="width: 1%">
                  <a href="<%= urlPrefix %><%= row.link %>"
                    class="badge color-<%= row.assessment_set_color %> color-hover">
                    <%= row.label %>
                  </a>
                </td>
                <td class="align-middle">
                  <a href="<%= urlPrefix %><%= row.link %>"><%= row.title %></a>
                </td>
                <td class="text-center align-middle">
                  <% if (row.assessment_instance_open !== false) { %>
                      <%= row.credit_date_string %>
                  <% } else { %>
                      Assessment closed.
                  <% } %>
                  <%- include('../partials/studentAccessRulesPopover', {
                      accessRules: row.access_rules,
                      assessmentSetName: row.assessment_set_name,
                      assessmentNumber: row.assessment_number,
                      }) %>
                </td>
                <td class="text-center align-middle">
                  <% if (row.assessment_instance_id) { %>
                      <%- include('../partials/scorebar', {score: row.assessment_instance_score_perc}) %>
                  <% } else { %>
                      Not started
                  <% } %>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        <% } %>

      </div>
    </div>
  </body>
</html>
