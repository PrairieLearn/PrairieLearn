<div class="card mb-4" id="question-score-panel">
  <div class="card-header bg-secondary text-white">Question <%= instance_question.question_number %></div>
  <table class="table table-sm two-column-description-no-header">
    <tbody>
      <% if (assessment.type === 'Exam') { %>
      <tr>
        <td>Best submission:</td>
        <td><%- include('../partials/examQuestionScore', {instance_question}); %></td>
      </tr>
      <tr>
        <td>Available points:</td>
        <td><%- include('../partials/examQuestionAvailablePoints', {open: assessment_instance.open && instance_question.open, points_list: instance_question.points_list, highest_submission_score: instance_question.highest_submission_score}); %></td>
      </tr>
      <tr>
        <td>Awarded points:</td>
        <td><%- include('../partials/examQuestionAwardedPoints', {points: instance_question.points, max_points: assessment_question.max_points}); %></td>
      </tr>
      <% } else if (assessment.type === 'Homework') { %>
      <tr>
        <td>Value:</td>
        <td><%- include('../partials/questionValue', {value: instance_question.current_value});  %></td>
      </tr>
      <tr>
        <td>History:</td>
        <td><%- include('../partials/questionAwardedPoints', {awarded_points: instance_question.variants_points_list, init_points: assessment_question.init_points});  %></td>
      </tr>
      <tr>
        <td>Awarded points:</td>
        <td><%- include('../partials/questionPointsOfMax', {points: instance_question.points, max_points: assessment_question.max_points}); %></td>
      </tr>
      <% } %>
    </tbody>
  </table>

  <% if (assessment.allow_issue_reporting) { %>
  <div class="card-footer">
    <button class="btn btn-xs btn-secondary" type="button" data-toggle="collapse" data-target="#issueCollapse" aria-expanded="false" aria-controls="issueCollapse">
      Report an error in this question <i class="far fa-caret-square-down"></i>
    </button>
    <div class="collapse" id="issueCollapse">
      <form method="POST">
        <p class="small mt-3">
          This form is only for reporting errors in the question
          itself. Do not use this form if you just don't know how to
          answer the question.
        </p>
        <div class="form-group">
          <textarea class="form-control" rows="5" name="description" placeholder="Describe the error in this question"></textarea>
        </div>
        <input type="hidden" name="__variant_id" value="<%= variant.id %>">
        <input type="hidden" name="__csrf_token" value="<%= __csrf_token %>">
        <div class="form-group text-right">
          <button class="btn btn-small btn-warning" name="__action" value="report_issue">Report error
        </div>
      </form>
    </div>
  </div>
  <% } %>
</div>

<div class="card mb-4" id="question-score-panel">
  <div class="card-header bg-secondary text-white">Attached files</div>
  <% if (file_list.length > 0) { %>
  <table class="table table-sm two-column-description-no-header">
    <tbody>
    <% file_list.forEach(function(file, iFile) { %>
      <tr>
        <td>
          <a target="_blank" href="<%= urlPrefix %>/assessment_instance/<%= assessment_instance.id %>/file/<%= file.id %>/<%= file.display_filename %>">
            <%= file.display_filename %>
          </a>
        </td>
        <td width="1%">
          <a id="attachFileDeleteButton<%= iFile %>"
             tabindex="0" class="btn btn-xs btn-secondary attachFileDeleteButton" role="button"
             data-toggle="popover" data-container="body"
             data-html="true" data-placement="auto" title="Confirm delete"
             data-content="<%= include('attachFileDeleteForm',
                           {id: 'attachFileDeleteButton' + iFile,
                           file}); %>"
             data-trigger="manual" onclick="$(this).popover('show')">
            <i class="far fa-trash-alt"></i>
          </a>
        </td>
      </tr>
    <% }); %>
    </tbody>
  </table>
  <% } %>
  <div class="card-footer">
    <!-- UPLOAD FILE -->
    <button class="btn btn-xs btn-secondary" type="button" data-toggle="collapse" data-target="#attachFileCollapse" aria-expanded="false" aria-controls="attachFileCollapse">
      Attach a file <i class="far fa-caret-square-down"></i>
    </button>
    <div class="collapse" id="attachFileCollapse">
      <form name="attach-file-form" method="POST" enctype="multipart/form-data" class="mb-3">
        <p class="small mt-3">
          Attached files will be saved with this question.
        </p>
        <div class="form-group">
          <div class="custom-file">
            <input type="file" name="file" class="custom-file-input" id="attachFileInput">
            <label class="custom-file-label" for="attachFileInput">Choose file</label>
          </div>
        </div>
        <div class="d-flex justify-content-end">
          <div class="form-group mb-0">
            <input type="hidden" name="__action" value="attach_file">
            <input type="hidden" name="__variant_id" value="<%= variant.id %>">
            <input type="hidden" name="__csrf_token" value="<%= __csrf_token %>">
            <button type="submit" class="btn btn-primary">Attach file</button>
          </div>
        </div>
      </form>
    </div>
    <!-- PASTE TEXT -->
    <br>
    <button class="btn btn-xs btn-secondary" type="button" data-toggle="collapse" data-target="#attachTextCollapse" aria-expanded="false" aria-controls="attachTextCollapse">
      Attach text <i class="far fa-caret-square-down"></i>
    </button>
    <div class="collapse" id="attachTextCollapse">
      <form method="POST">
        <p class="small mt-3">
          Type or paste text below and click "attach".
          The text will be saved with this question for your reference.
        </p>
        <input name="filename" value="notes.txt">
        <div class="form-group">
          <textarea class="form-control" rows="5" name="contents" placeholder="Type or paste text here"></textarea>
        </div>
        <input type="hidden" name="__variant_id" value="<%= variant.id %>">
        <input type="hidden" name="__csrf_token" value="<%= __csrf_token %>">
        <div class="form-group text-right">
          <button class="btn btn-small btn-primary" name="__action" value="attach_text">Attach text</button>
        </div>
      </form>
    </div>
    <!-- END OF FILES -->
  </div>
</div>
