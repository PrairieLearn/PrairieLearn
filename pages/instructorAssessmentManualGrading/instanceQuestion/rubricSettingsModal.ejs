<div class="modal js-rubric-settings-modal rubric-settings-modal-<%= type %>" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-xl border-info" role="document">
    <form name="rubric-settings-<%= type %>" method="POST" class="needs-validation">
      <input type="hidden" name="__csrf_token" value="<%= __csrf_token %>">
      <input type="hidden" name="__action" value="modify_rubric_settings">
      <input type="hidden" name="rubric_type" value="<%= type %>">
      <input type="hidden" name="modified_at" value="<%= rubric?.rubric_data?.modified_at %>">
      
      <div class="modal-content">
        <div class="modal-header bg-info text-light">
          <h5 class="modal-title">Rubric settings: <%= type %> grading</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-check">
            <label class="form-check-label">
              <input class="form-check-input" name="use_rubrics" type="checkbox" value="true" <% if (rubric?.rubric_data) { %>checked<% } %>>
              Use rubrics
            </label>
          </div>
          <div class="js-rubric-settings-info">
            <hr/>
            <div class="form-row">
              <div class="col-4">
                <div class="form-check">
                  <label class="form-check-label" data-toggle="tooltip"
                         title="Start grading at zero and add points">
                    <input class="form-check-input" name="starting_points" type="radio" value="0"
                           <% if ((rubric?.rubric_data?.starting_points ?? 0) == 0) { %>checked<% } %>>
                    Positive grading
                  </label>
                </div>
                <div class="form-check">
                  <label class="form-check-label" data-toggle="tooltip"
                         title="Start grading at 100% (<%= max_points %> points) and subtract penalties">
                    <input class="form-check-input js-negative-grading" name="starting_points" type="radio" value="<%= max_points %>"
                           <% if (rubric?.rubric_data?.starting_points == max_points) { %>checked<% } %>>
                    Negative grading
                  </label>
                </div>
                <div class="form-check">
                  <label class="form-check-label">
                    <input class="form-check-input" name="starting_points" type="radio" value="CUSTOM"
                           <% if (![0, max_points].includes(rubric?.rubric_data?.starting_points ?? 0)) { %>checked<% } %>>
                    Custom starting points
                  </label>
                </div>
                <div class="js-starting-points-custom">
                  <label><span class="sr-only">Starting points</span>
                    <input class="form-control" name="starting_points_custom" type="number" value="<%= rubric?.rubric_data?.starting_points ?? max_points %>">
                  </label>
                </div>
              </div>
              <div class="form-group col-4">
                <label data-toggle="tooltip" title="Minimum number of points to be assigned to a student from the rubric (out of <%= max_points %>). Rubric items with negative points will not cause the grade to become lower than this value.">
                  Minimum points
                  <input class="form-control" name="min_points" type="number" value="<%= rubric?.rubric_data?.min_points ?? 0 %>">
                </label>
              </div>
              <div class="form-group col-4">
                <label data-toggle="tooltip" title="Minimum number of points to be assigned to a student from the rubric (out of <%= max_points %>). Rubric items with positive points will not cause the grade to become higher than this value.">
                  Maximum points
                  <input class="form-control" name="max_points" type="number" value="<%= rubric?.rubric_data?.max_points ?? max_points %>">
                </label>
              </div>
            </div>
            <hr/>
            <div>
              <table class="table table-sm table-striped js-rubric-items-table">
                <thead>
                  <tr>
                    <th style="width: 1px"><!-- Order --></th>
                    <th>Points</th>
                    <th>Text</th>
                    <th>Detailed description</th>
                    <th>Grader note</th>
                    <th>In use</th>
                </thead>
                <tbody>
                  <% (rubric?.rubric_items || []).forEach((item, index) => { %>
                  <tr ondragover="rowDragOver(event)">
                    <td class="text-nowrap">
                      <input type="hidden"
                             name="rubric_item[cur<%= item.rubric_item.id %>][id]"
                             value="<%= item.rubric_item.id %>">
                      <input type="hidden" class="js-rubric-item-row-order"
                             name="rubric_item[cur<%= item.rubric_item.id %>][order]"
                             value="<%= index %>">
                      <button type="button" class="btn btn-sm"
                              draggable="true" ondragstart="rowDragStart(event)">
                        <i class="fas fa-arrows-up-down"></i>
                      </button>
                      <button type="button" class="btn btn-sm sr-only" onclick="moveRowDown(event)">
                        Move down
                      </button>
                      <button type="button" class="btn btn-sm sr-only" onclick="moveRowUp(event)">
                        Move up
                      </button>
                      <button type="button" class="btn btn-sm js-rubric-item-delete text-danger">
                        <i class="fas fa-trash"></i>
                        <span class="sr-only">Delete</span>
                      </button>
                    </td>
                    <td style="max-width: 4rem">
                      <input type="number" class="form-control" step="any" required
                             name="rubric_item[cur<%= item.rubric_item.id %>][points]"
                             value="<%= item.rubric_item.points %>">
                    </td>
                    <td>
                      <input type="text" class="form-control" required maxlength="100"
                             name="rubric_item[cur<%= item.rubric_item.id %>][short_text]"
                             value="<%= item.rubric_item.short_text %>">
                    </td>
                    <td>
                      <label data-input-name="rubric_item[cur<%= item.rubric_item.id %>][description]"
                             data-current-value="<%= item.rubric_item.description %>">
                        <%= item.rubric_item.description %>
                        <button type="button" class="btn btn-sm"
                                onclick="enableRubricItemDescriptionField(event)">
                          <i class="fas fa-pencil"></i>
                        </button>
                      </label>
                    </td>
                    <td>
                      <label data-input-name="rubric_item[cur<%= item.rubric_item.id %>][staff_instructions]"
                             data-current-value="<%= item.rubric_item.staff_instructions %>">
                        <%= item.rubric_item.staff_instructions %>
                        <button type="button" class="btn btn-sm"
                                onclick="enableRubricItemDescriptionField(event)">
                          <i class="fas fa-pencil"></i>
                        </button>
                      </label>
                    </td>
                    <td>
                      <% if (!item.num_submissions) { %>No
                      <% } else if (!item.num_submissions == 1) { %>1 submission
                      <% } else { %><%= item.num_submissions %> submissions
                      <% } %>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
              <button type="button" class="btn btn-sm btn-secondary js-add-rubric-item-button">
                Add item
              </button>
              <% if (variant.params || variant.true_answer) { %>
              <div class="small form-text text-muted">
                Rubric items may be populated with values like:
                <ul style="max-height: 7rem; overflow-y: auto;">
                  <% Object.keys(variant.params || {}).forEach((key) => { %>
                  <li><code>{{params.<%= key %>}}</code></li>
                  <% }); %>
                  <% Object.keys(variant.true_answer || {}).forEach((key) => { %>
                  <li><code>{{correct_answers.<%= key %>}}</code></li>
                  <% }); %>
                </ul>
              </div>
              <% } %>
            </div>
            <hr/>
            <div class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="checkbox" value="true"
                       name="tag_for_manual_grading">
                Require all graded submissions to be manually graded/reviewed
              </label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <% if (authz_data.has_course_instance_permission_edit) { %>
          <button type="submit" class="btn btn-primary">Confirm</button>
          <% } %>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </form>
  </div>
</div>
