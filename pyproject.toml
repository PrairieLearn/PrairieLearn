[tool.ruff]
include = [
    "./apps/prairielearn/elements/**/*.py",
    "./apps/prairielearn/python/*.py",
    "./graders/**/*.py",
    "./exampleCourse/**/*.py",
    "./testCourse/**/*.py",
    "./tools/**/*.py"
]
exclude = [
    # These files are intentionally not parseable as Python.
    "./exampleCourse/questions/demo/autograder/codeUpload/submitted_code_samples/fib_error_binary_file/fib.py",
    "./exampleCourse/questions/demo/autograder/codeUpload/submitted_code_samples/fib_error_large_text_file/fib.py",
    # Files related to the Python autograder will often intentionally appear
    # broken in isolation. We'll exclude these files from linting.
    "exampleCourse/questions/**/tests/initial_code.py",
    "exampleCourse/questions/**/tests/trailing_code.py",
]
target-version = "py310"

[tool.ruff.lint]
select = [
    "E",
    "N",
    # pyflakes
    "F",
    # isort
    "I",
    # flake8-bugbear
    "B",
    # flake8-simplify
    "SIM",
    # pyupgrade
    "UP",
    # tryceratops
    "TRY",
    # flake8-pie
    "PIE",
    # Perflint
    "PERF",
    # flake8-comprehensions
    "C4",
    # ruff-specific rules
    "RUF",
    # flake8-import-conventions
    "ICN",
    # flake8-implicit-str-concat
    "ISC",
    # flake8-pytest-style
    "PT",
    # flake8-unused-arguments
    "ARG",
    # refurb
    "FURB",
    # pandas-vet
    "PD",
    # NumPy-specific rules
    "NPY",
    # pylint
    "PLR",
    # flake8-2020
    "YTT",
    # flake8-async
    "ASYNC",
    # flake8-datetimez
    "DTZ",
    # flake8-debugger
    "T10",
    # flake8-logging
    "LOG",
    # flake8-pyi
    "PYI",
    # flake8-slots
    "SLOT",
    # flake8-gettext
    "INT",
    # flynt
    "FLY"
]

ignore = [
    # Ignore line length errors
    "E501",
    # if-else blocks that could be shortened (https://docs.astral.sh/ruff/rules/if-else-block-instead-of-if-exp/)
    "SIM108",
    # Allow for returns in try blocks
    "TRY300",
    # Abstract raise to an inner function
    "TRY301",
     # Avoid specifying long messages outside the exception class
    "TRY003",
    # Too many statements, too many branches, too many arguments, too many returns
    "PLR0912", "PLR0915", "PLR0913", "PLR0911",
    # Magic value used in comparison (foo == 5)
    "PLR2004",
    # Explicit string concatenation
    "ISC003",
    # Avoid using the generic variable name `df` for DataFrames
    "PD901",
    # Replace legacy `np.random.*` call with `np.random.Generator`
    "NPY002",
]
[tool.ruff.lint.per-file-ignores]
# Files related to the Python autograder will often intentionally appear
# broken in isolation. We'll allow specific errors in these files to
# account for that.
#
# - F401: module imported but unused
# - F821: undefined name
# - F841: local variable name is assigned to but never used
# - ARG001: Unused function argument
"exampleCourse/questions/**/tests/setup_code.py" = ["F401", "F821"]
"exampleCourse/questions/**/tests/leading_code.py" = ["F401", "F821", "F841", "ARG001"]
"exampleCourse/questions/**/tests/ans.py" = ["F821"]
"exampleCourse/questions/demo/autograder/codeUpload/submitted_code_samples/**/*.py" = ["ARG001"]

# Ignore uppercase variables and function parameters (e.g. G for a graph)
"exampleCourse/questions/**/*.py" = ["N806", "N803"]
# The zygote specifically uses imports in strange places to facilitate the
# preloading of commonly-used modules.
"zygote.py" = ["E402", "F401"]
# Ignore uppercase function parameters (e.g. G for a graph), ignore unused parameters in functions
"apps/prairielearn/elements/**/*.py" = ["N803", "ARG"]
"apps/prairielearn/python/*.py" = ["N803"]
# Do not require self in method params
"apps/prairielearn/elements/pl-drawing/elements.py" = ["N805"]
"exampleCourse/elementExtensions/pl-drawing/example-logo/example-logo.py" = ["N805"]
[tool.ruff.format]
exclude = [
    "./exampleCourse/questions/demo/autograder/python/leadingTrailing/tests/trailing_code.py",
    "./exampleCourse/questions/demo/autograder/python/square/tests/initial_code.py",
]

[tool.pyright]
include = [
    "./apps/prairielearn/elements/pl-answer-panel",
    "./apps/prairielearn/elements/pl-big-o-input",
    "./apps/prairielearn/elements/pl-card",
    "./apps/prairielearn/elements/pl-code",
    "./apps/prairielearn/elements/pl-dataframe",
    "./apps/prairielearn/elements/pl-excalidraw",
    "./apps/prairielearn/elements/pl-external-grader-results",
    "./apps/prairielearn/elements/pl-external-grader-variables",
    "./apps/prairielearn/elements/pl-figure",
    "./apps/prairielearn/elements/pl-file-download",
    "./apps/prairielearn/elements/pl-file-editor",
    "./apps/prairielearn/elements/pl-file-preview",
    "./apps/prairielearn/elements/pl-file-upload",
    "./apps/prairielearn/elements/pl-graph",
    "./apps/prairielearn/elements/pl-hidden-hints",
    "./apps/prairielearn/elements/pl-hide-in-manual-grading",
    "./apps/prairielearn/elements/pl-hide-in-panel",
    "./apps/prairielearn/elements/pl-integer-input",
    "./apps/prairielearn/elements/pl-manual-grading-only",
    "./apps/prairielearn/elements/pl-matrix-latex",
    "./apps/prairielearn/elements/pl-multiple-choice",
    "./apps/prairielearn/elements/pl-number-input",
    "./apps/prairielearn/elements/pl-overlay",
    "./apps/prairielearn/elements/pl-order-blocks",
    "./apps/prairielearn/elements/pl-python-variable",
    "./apps/prairielearn/elements/pl-question-panel",
    "./apps/prairielearn/elements/pl-string-input",
    "./apps/prairielearn/elements/pl-submission-panel",
    "./apps/prairielearn/elements/pl-symbolic-input",
    "./apps/prairielearn/elements/pl-template",
    "./apps/prairielearn/elements/pl-units-input",
    "./apps/prairielearn/elements/pl-variable-output",
    "./apps/prairielearn/elements/pl-workspace",
    "./apps/prairielearn/elements/pl-xss-safe",
    "./apps/prairielearn/python/check_data_test.py",
    "./apps/prairielearn/python/check_data.py",
    "./apps/prairielearn/python/colors_test.py",
    "./apps/prairielearn/python/colors.py",
    "./apps/prairielearn/python/conftest.py",
    "./apps/prairielearn/python/prairielearn_test.py",
    "./apps/prairielearn/python/prairielearn.py",
    "./apps/prairielearn/python/python_helper_sympy_test.py",
    "./apps/prairielearn/python/python_helper_sympy.py",
    "./apps/prairielearn/python/question_phases.py",
    "./apps/prairielearn/python/traverse_test.py",
    "./apps/prairielearn/python/traverse.py",
    "./apps/prairielearn/python/zygote.py",
    "./apps/prairielearn/python/zygote_utils.py",
    "./apps/prairielearn/python/zygote_utils_test.py",
]
extraPaths = ["./apps/prairielearn/python"]
pythonVersion = "3.10"
reportUnnecessaryTypeIgnoreComment = "error"

[tool.pytest.ini_options]
addopts = "--cov=apps"
testpaths = ["apps/prairielearn/elements", "apps/prairielearn/python"]
