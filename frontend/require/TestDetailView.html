<div id="confirmResetTestModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Are you sure you want to reset <strong>{{title}}</strong> for <strong>{{userUID}}</strong>? This will delete all progress on this assessment and cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-warning resetTest" id="resetTest">Reset for current user</button>
        <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div id="confirmResetTestForAllModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Are you sure you want to reset <strong>{{title}}</strong> for <strong>all users</strong>? This will delete all progress on this assessment for every user and cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger resetTestForAll" id="resetTestForAll">Reset for all users</button>
        <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div id="confirmFinishTestForAllModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Are you sure you want to finish all open instances of <strong>{{title}}</strong> for <strong>all users</strong>? Any in-progress tests will be finished by this action and students will not be able to submit any further answers. This cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger finishTestForAll" id="finishTestForAll">Finish for all users</button>
        <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div id="actionResult">
</div>

<div class="page-header">
  <h1>{{title}}</h1>
</div>

{{#seeTestStats}}
<p>
  <button class="btn btn-info reloadStats">Reload statistics</button>
</p>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Test statistics</h3>
  </div>

  {{#hasTestStats}}
  <table class="table table-condensed table-hover">
    <thead>
      <tr>
        <th style="width: 15em">Statistic</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Number of students</td><td>{{n}}</td></tr>
      <tr><td>Mean score</td><td>{{mean}}%</td></tr>
      <tr><td>Standard deviation</td><td>{{stddev}}%</td></tr>
      <tr><td>Minimum score</td><td>{{min}}%</td></tr>
      <tr><td>Median score</td><td>{{median}}%</td></tr>
      <tr><td>Maximum score</td><td>{{max}}%</td></tr>
      <tr><td>Number of 0%</td><td>{{nZeroScore}} ({{fracZeroScore}}% of class)</td></tr>
      <tr><td>Number of 100%</td><td>{{nFullScore}} ({{fracFullScore}}% of class)</td></tr>
    </tbody>
  </table>
  <div class="panel-footer">
    <div id="scoreHistogramPlot" class="scoreHistogram"></div>
  </div>
  {{/hasTestStats}}

  {{^hasTestStats}}
  <div class="panel-body">
    <p>
      Loading...
    </p>
  </div> <!-- panel-body -->
  {{/hasTestStats}}

</div>

<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Question statistics</h3>
  </div>

  {{#hasTestStats}}
  <table class="table table-condensed table-hover">
    <thead>
      <tr>
        <th>Question</th>
        <th>Mean score</th>
        <th>Discrimination</th>
        <th>Number attempts</th>
        <th>Fraction solved</th>
        <th>Number of students</th>
        <th>Scores by quintile</th>
      </tr>
    </thead>
    <tbody>
      {{#qStats}}
      <tr>
        <td>{{title}} ({{qid}})</td>
        <td>{{meanScore}}%</td>
        <td>{{discrimination}}%</td>
        <td>{{meanNAttempts}}</td>
        <td>{{fracEverCorrect}}%</td>
        <td>{{n}}</td>
        <td>{{meanScoreByQuintileString}}</td>
      </tr>
      {{/qStats}}
    </tbody>
  </table>
  {{/hasTestStats}}

  {{^hasTestStats}}
  <div class="panel-body">
    <p>
      Loading...
    </p>
  </div> <!-- panel-body -->
  {{/hasTestStats}}

</div>
{{/seeTestStats}}

{{#seeFinish}}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Finish tests</h3>
  </div>

  <div class="panel-body">
    <p>
        <button class="btn btn-danger" data-toggle="modal" data-target="#confirmFinishTestForAllModal">Finish for all users</button>
    </p>
    <p>
      <small>
        This button does the equivalent of having each student individually click the "Finish" button on their test. Students have the option to do this themselves, but sometimes they forget or they don't bother. You should finish all tests before downloading the final test scores, to make sure all test scores are fully computed. After a test is finished, students cannot answer any more questions on it. You should not finish all tests until all students have completed the test.
      </small>
    </p>
  </div> <!-- panel-body -->

</div>
{{/seeFinish}}

{{#seeDownload}}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Download test data</h3>
  </div>

  <table class="table table-condensed table-hover">
    <thead>
      <tr>
        <th>Data file</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="{{testScoresLink}}">{{testScoresFilename}}</a></td>
        <td>Total scores for all students. Scores range from 0 to 100.</td>
      </tr>
      <tr>
        <td><a href="{{testScoresCompassLink}}">{{testScoresCompassFilename}}</a></td>
        <td>Total scores for all students, formatted for upload into Compass2g. Scores range from 0 to 100.</td>
      </tr>
      <tr>
        <td><a href="{{testFinalSubmissionsLink}}">{{testFinalSubmissionsFilename}}</a></td>
        <td>Final submitted answers for all students that were used to compute the total score.</td>
      </tr>
      <tr>
        <td><a href="{{testAllSubmissionsLink}}">{{testAllSubmissionsFilename}}</a></td>
        <td>All submitted answers for all students. Not all submitted answers will have been used to compute the final score, as some may have been overwritten by subsequent attempts.</td>
      </tr>
      <tr>
        <td><a href="{{testFilesZipLink}}">{{testFilesZipFilename}}</a></td>
        <td>Final submitted files for all students. Only questions with <tt>File</tt>-type questions will be included in the zip.</td>
      </tr>
    </tbody>
  </table>
  
</div>
{{/seeDownload}}

{{#seeReset}}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Reset tests</h3>
  </div>

  <div class="panel-body">

    <div class="row">
      <div class="col-sm-6 col-xs-12">
        <button class="btn btn-warning" data-toggle="modal" data-target="#confirmResetTestModal">Reset for current user</button>
      </div>
      <div class="col-sm-6 col-xs-12">
        <button class="btn btn-danger" data-toggle="modal" data-target="#confirmResetTestForAllModal">Reset for all users</button>
      </div>
    </div> <!-- row -->

  </div> <!-- panel-body -->

</div>
{{/seeReset}}

<div id="tDetail">
</div>
